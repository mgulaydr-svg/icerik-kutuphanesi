<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ä°Ã§erik KÃ¼tÃ¼phanesi</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
:root{
--bg:#faf8f5;--card:#fff;--sidebar:#f5f0eb;--accent:#b8a9c9;
--text:#3d3d3d;--muted:#8a8a8a;--border:#e8e2da;
--shadow:0 2px 12px rgba(0,0,0,.06);--r:16px;
--pp:#d4c5e2;--pb:#b8d4e3;--ppk:#e8c5d0;--pg:#bdd8c0;
--po:#e8d0b3;--py:#e8e0b3;--pr:#e2b8b8;--pgr:#d4d0cc;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}

.login-screen{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#f5f0eb,#e8d0e8,#d4e0f0)}
.login-box{background:#fff;border-radius:24px;padding:48px 40px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.1);max-width:400px;width:90%}
.login-box .logo{font-size:3.5rem;margin-bottom:16px}
.login-box h1{font-size:1.4rem;font-weight:700;margin-bottom:8px;background:linear-gradient(135deg,#b8a9c9,#e8c5d0);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.login-box p{color:var(--muted);font-size:.9rem;margin-bottom:28px;line-height:1.5}
.g-btn{display:inline-flex;align-items:center;gap:10px;padding:14px 28px;border:1px solid var(--border);border-radius:14px;background:#fff;cursor:pointer;font-size:.95rem;font-weight:500;transition:all .2s;font-family:inherit}
.g-btn:hover{background:var(--bg);box-shadow:0 4px 16px rgba(0,0,0,.08);transform:translateY(-1px)}
.g-btn svg{width:20px;height:20px}

.app{display:flex;min-height:100vh}
.sidebar{width:270px;background:var(--sidebar);border-right:1px solid var(--border);padding:20px 14px;display:flex;flex-direction:column;gap:6px;position:fixed;top:0;left:0;bottom:0;overflow-y:auto;z-index:100;transition:transform .3s}
.sidebar-header{display:flex;align-items:center;gap:10px;padding:8px 12px;margin-bottom:4px}
.sidebar-header h1{font-size:1.1rem;font-weight:700;background:linear-gradient(135deg,#b8a9c9,#e8c5d0);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.sidebar-header .logo{font-size:1.4rem}
.user-info{display:flex;align-items:center;gap:10px;padding:10px 12px;background:rgba(184,169,201,.1);border-radius:10px;margin-bottom:8px}
.user-info img{width:30px;height:30px;border-radius:50%}
.user-info .name{font-size:.8rem;font-weight:500}
.user-info .role{font-size:.65rem;color:var(--accent);font-weight:600;text-transform:uppercase}
.nav-section{margin-top:12px}
.nav-section h3{font-size:.65rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);padding:4px 12px;margin-bottom:4px}
.nav-btn{display:flex;align-items:center;gap:9px;padding:9px 12px;border:none;background:none;border-radius:10px;cursor:pointer;width:100%;font-size:.84rem;color:var(--text);transition:all .2s;text-align:left}
.nav-btn:hover{background:rgba(184,169,201,.15)}.nav-btn.active{background:rgba(184,169,201,.25);font-weight:600}
.nav-btn .icon{font-size:1rem;width:22px;text-align:center}
.nav-btn .badge{margin-left:auto;background:var(--accent);color:#fff;font-size:.65rem;padding:2px 7px;border-radius:10px}

.main{flex:1;margin-left:270px;padding:24px 28px;max-width:1200px}
.top-bar{display:flex;align-items:center;gap:12px;margin-bottom:22px;flex-wrap:wrap}
.hamburger{display:none;background:none;border:none;font-size:1.5rem;cursor:pointer}
.search-box{flex:1;min-width:160px;position:relative}
.search-box input{width:100%;padding:10px 14px 10px 38px;border:1px solid var(--border);border-radius:12px;background:var(--card);font-size:.86rem;outline:none;transition:border .2s}
.search-box input:focus{border-color:var(--accent)}
.search-box::before{content:'\1F50D';position:absolute;left:11px;top:50%;transform:translateY(-50%);font-size:.82rem}

.btn{padding:9px 16px;border:none;border-radius:12px;cursor:pointer;font-size:.82rem;font-weight:500;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:linear-gradient(135deg,var(--pp),var(--ppk));color:#fff}
.btn-primary:hover{opacity:.9;transform:translateY(-1px)}
.btn-secondary{background:var(--card);border:1px solid var(--border);color:var(--text)}
.btn-secondary:hover{background:var(--sidebar)}
.btn-sm{padding:5px 11px;font-size:.76rem;border-radius:8px}
.btn-danger{background:#e8b8b8;color:#7a3030}.btn-danger:hover{background:#daa}

.cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
.card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);overflow:hidden;cursor:pointer;transition:all .25s;border:1px solid var(--border)}
.card:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,.1)}
.card-cover{height:120px;display:flex;align-items:center;justify-content:center;font-size:2.6rem;position:relative}
.card-cover .type-badge{position:absolute;top:8px;right:8px;background:rgba(255,255,255,.85);backdrop-filter:blur(4px);padding:3px 8px;border-radius:7px;font-size:.68rem;font-weight:600}
.card-cover .file-count{position:absolute;bottom:8px;right:8px;background:rgba(0,0,0,.5);color:#fff;padding:2px 7px;border-radius:6px;font-size:.66rem}
.card-body{padding:13px}
.card-body h3{font-size:.88rem;font-weight:600;margin-bottom:4px;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.card-body .meta{font-size:.74rem;color:var(--muted);margin-bottom:6px}
.card-tags{display:flex;flex-wrap:wrap;gap:3px}
.tag{font-size:.64rem;padding:2px 7px;border-radius:6px;font-weight:500}
.t-ga{background:var(--ppk);color:#8a5070}.t-us{background:var(--pp);color:#6a5080}.t-cy{background:var(--pr);color:#8a5050}
.t-yd{background:var(--pb);color:#4a6a80}.t-es{background:var(--pg);color:#4a7050}.t-as{background:var(--py);color:#7a7040}
.t-hs{background:var(--po);color:#7a6040}.t-vb{background:var(--pgr);color:#5a5a5a}.t-kr{background:#d4c9b8;color:#6a5a40}.t-ge{background:#e0dcd8;color:#5a5a5a}

.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);backdrop-filter:blur(4px);z-index:200;display:flex;align-items:center;justify-content:center;padding:16px;opacity:0;pointer-events:none;transition:opacity .25s}
.modal-overlay.show{opacity:1;pointer-events:all}
.modal{background:var(--card);border-radius:var(--r);width:100%;max-width:680px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.15);transform:translateY(20px);transition:transform .25s}
.modal-overlay.show .modal{transform:translateY(0)}
.modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px 22px;border-bottom:1px solid var(--border)}
.modal-header h2{font-size:1rem;font-weight:600}
.modal-close{background:none;border:none;font-size:1.2rem;cursor:pointer;color:var(--muted)}
.modal-body{padding:22px}
.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:.78rem;font-weight:500;margin-bottom:4px}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:9px 12px;border:1px solid var(--border);border-radius:10px;font-size:.84rem;background:var(--bg);outline:none;transition:border .2s;font-family:inherit}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:var(--accent)}
.form-group textarea{resize:vertical;min-height:70px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.tag-input-wrap{display:flex;flex-wrap:wrap;gap:4px;padding:7px 10px;border:1px solid var(--border);border-radius:10px;background:var(--bg);min-height:38px;align-items:center;cursor:text}
.tag-input-wrap .tag{display:flex;align-items:center;gap:3px}
.tag-input-wrap .tag button{background:none;border:none;cursor:pointer;font-size:.78rem;color:inherit;opacity:.7}
.tag-input-wrap input{border:none;background:none;outline:none;flex:1;min-width:70px;padding:2px;font-size:.82rem}
.file-drop{border:2px dashed var(--border);border-radius:12px;padding:24px;text-align:center;cursor:pointer;transition:all .2s;background:var(--bg)}
.file-drop:hover,.file-drop.dragover{border-color:var(--accent);background:rgba(184,169,201,.08)}
.file-drop .icon{font-size:1.6rem;margin-bottom:4px}
.file-drop p{font-size:.8rem;color:var(--muted)}
.file-list{margin-top:8px;display:flex;flex-direction:column;gap:5px}
.file-item{display:flex;align-items:center;gap:8px;padding:7px 10px;background:var(--bg);border-radius:8px;font-size:.8rem;border:1px solid var(--border)}
.file-item .fname{flex:1;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.file-item .fsize{color:var(--muted);font-size:.72rem}
.file-item .fbtn{background:none;border:none;cursor:pointer;font-size:.85rem;padding:2px 4px;border-radius:4px}
.file-item .fbtn:hover{background:rgba(0,0,0,.06)}
.file-item .del{color:#c44}

.viewer-overlay{position:fixed;inset:0;background:rgba(20,20,20,.92);z-index:300;display:flex;flex-direction:column;opacity:0;pointer-events:none;transition:opacity .25s}
.viewer-overlay.show{opacity:1;pointer-events:all}
.viewer-top{display:flex;align-items:center;justify-content:space-between;padding:12px 22px;color:#fff}
.viewer-top h3{font-size:.92rem;font-weight:500}
.viewer-top button{background:rgba(255,255,255,.15);border:none;color:#fff;padding:7px 14px;border-radius:8px;cursor:pointer;font-size:.82rem}
.viewer-content{flex:1;display:flex;align-items:center;justify-content:center;padding:16px;overflow:auto}
.viewer-content .text-view{max-width:780px;width:100%;background:var(--card);padding:28px;border-radius:var(--r);max-height:85vh;overflow-y:auto;font-size:.9rem;line-height:1.7}

.stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-bottom:20px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center}
.stat-card .num{font-size:1.4rem;font-weight:700}.stat-card .label{font-size:.7rem;color:var(--muted);margin-top:2px}
.section-title{font-size:.76rem;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin:22px 0 10px;font-weight:600}
.section-title:first-of-type{margin-top:0}
.empty-state{text-align:center;padding:60px 20px}
.empty-state .icon{font-size:3rem;margin-bottom:12px}
.empty-state h3{font-size:1rem;margin-bottom:6px}
.empty-state p{color:var(--muted);font-size:.85rem}
.toast{position:fixed;bottom:20px;right:20px;background:#3d3d3d;color:#fff;padding:11px 18px;border-radius:10px;font-size:.82rem;z-index:400;transform:translateY(80px);opacity:0;transition:all .3s}
.toast.show{transform:translateY(0);opacity:1}
.spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-overlay{position:fixed;inset:0;background:rgba(250,248,245,.9);z-index:500;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:14px}
.loading-overlay .big-spinner{width:36px;height:36px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
.upload-progress{width:100%;height:4px;background:var(--border);border-radius:2px;margin-top:6px;overflow:hidden}
.upload-progress .bar{height:100%;background:var(--accent);border-radius:2px;transition:width .3s}

@media(max-width:768px){
.sidebar{transform:translateX(-100%)}.sidebar.visible{transform:translateX(0)}
.main{margin-left:0;padding:14px}.hamburger{display:block}
.cards-grid{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}
.form-row{grid-template-columns:1fr}.stats-row{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>
<div class="loading-overlay" id="loadingOverlay"><div class="big-spinner"></div><div style="color:var(--muted);font-size:.88rem">YÃ¼kleniyor...</div></div>

<div class="login-screen" id="loginScreen" style="display:none">
<div class="login-box">
<div class="logo">ğŸ“š</div>
<h1>Ä°Ã§erik KÃ¼tÃ¼phanesi</h1>
<p>EÄŸitim materyallerine eriÅŸmek iÃ§in<br>Google hesabÄ±nÄ±zla giriÅŸ yapÄ±n</p>
<button class="g-btn" onclick="signIn()">
<svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
Google ile GiriÅŸ Yap
</button>
</div>
</div>

<div class="app" id="appScreen" style="display:none">
<aside class="sidebar" id="sidebar">
<div class="sidebar-header"><span class="logo">ğŸ“š</span><h1>Ä°Ã§erik KÃ¼tÃ¼phanesi</h1></div>
<div class="user-info" id="userInfo"></div>
<button class="nav-btn active" data-filter="all" onclick="filterBy('all')"><span class="icon">ğŸ </span> TÃ¼m Ä°Ã§erikler <span class="badge" id="countAll">0</span></button>
<div class="nav-section"><h3>Ä°Ã§erik TÃ¼rÃ¼</h3>
<button class="nav-btn" data-filter="type:Sesli Ã–zet" onclick="filterBy('type','Sesli Ã–zet')"><span class="icon">ğŸ§</span> Sesli Ã–zetler</button>
<button class="nav-btn" data-filter="type:Video Ã–zet" onclick="filterBy('type','Video Ã–zet')"><span class="icon">ğŸ¬</span> Video Ã–zetler</button>
<button class="nav-btn" data-filter="type:PDF Sunum" onclick="filterBy('type','PDF Sunum')"><span class="icon">ğŸ“„</span> PDF Sunumlar</button>
<button class="nav-btn" data-filter="type:Metin Ã–zeti" onclick="filterBy('type','Metin Ã–zeti')"><span class="icon">ğŸ“</span> Metin Ã–zetleri</button>
</div>
<div class="nav-section"><h3>Ana Konular</h3><div id="topicNav"></div></div>
<div style="margin-top:auto;padding-top:14px"><button class="btn btn-secondary btn-sm" onclick="signOut()" style="width:100%">ğŸšª Ã‡Ä±kÄ±ÅŸ Yap</button></div>
</aside>

<div class="main">
<div class="top-bar">
<button class="hamburger" onclick="toggleSidebar()">â˜°</button>
<div class="search-box"><input type="text" id="searchInput" placeholder="Ä°Ã§erik ara..." oninput="renderCards()"></div>
<div id="adminActions" style="display:none"><button class="btn btn-primary" onclick="openAddModal()">â• Yeni Ä°Ã§erik</button></div>
</div>
<div class="stats-row" id="statsRow"></div>
<div id="contentArea"></div>
</div>
</div>

<div class="modal-overlay" id="addModal">
<div class="modal">
<div class="modal-header"><h2 id="modalTitle">â• Yeni Ä°Ã§erik Ekle</h2><button class="modal-close" onclick="closeModal('addModal')">âœ•</button></div>
<div class="modal-body">
<input type="hidden" id="editId">
<div class="form-group"><label>Ä°Ã§erik AdÄ± *</label><input type="text" id="fTitle" placeholder="BaÅŸlÄ±k yazÄ±n..."></div>
<div class="form-row">
<div class="form-group"><label>Ä°Ã§erik TÃ¼rÃ¼ *</label><select id="fType"><option value="">SeÃ§iniz...</option><option value="Sesli Ã–zet">ğŸ§ Sesli Ã–zet</option><option value="Video Ã–zet">ğŸ¬ Video Ã–zet</option><option value="PDF Sunum">ğŸ“„ PDF Sunum</option><option value="Metin Ã–zeti">ğŸ“ Metin Ã–zeti</option></select></div>
<div class="form-group"><label>Ana Konu *</label><select id="fTopic"><option value="">SeÃ§iniz...</option></select></div>
</div>
<div class="form-row">
<div class="form-group"><label>Alt Konu</label><input type="text" id="fSubtopic" placeholder="Alt konu..."></div>
<div class="form-group"><label>EÄŸitici</label><input type="text" id="fInstructor" placeholder="EÄŸitici adÄ±..."></div>
</div>
<div class="form-group"><label>Etiketler <span style="font-weight:400;color:var(--muted)">(Enter ile ekleyin)</span></label>
<div class="tag-input-wrap" id="tagWrap" onclick="document.getElementById('tagInput').focus()"><input type="text" id="tagInput" placeholder="Etiket yazÄ±n..."></div></div>
<div class="form-group"><label>Dosyalar <span style="font-weight:400;color:var(--muted)">(birden fazla eklenebilir â€” sonradan da ekleyip silebilirsiniz)</span></label>
<div class="file-drop" id="fileDrop"><div class="icon">ğŸ“</div><p>DosyalarÄ± sÃ¼rÃ¼kleyin veya tÄ±klayarak seÃ§in</p><p style="font-size:.7rem;margin-top:3px;color:#aaa">Ses, video, PDF dosyalarÄ±</p></div>
<input type="file" id="fileInput" accept="audio/*,video/*,application/pdf" multiple style="display:none">
<div class="file-list" id="pendingFiles"></div>
<div class="upload-progress" id="uploadProgress" style="display:none"><div class="bar" id="uploadBar"></div></div>
</div>
<div class="form-group"><label>Ã–zet / Notlar</label><textarea id="fSummary" rows="3" placeholder="KÄ±sa Ã¶zet veya notlar..."></textarea></div>
<div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
<button class="btn btn-secondary" onclick="closeModal('addModal')">Ä°ptal</button>
<button class="btn btn-primary" id="saveBtn" onclick="saveItem()">ğŸ’¾ Kaydet</button>
</div>
</div></div></div>

<div class="viewer-overlay" id="viewer">
<div class="viewer-top"><h3 id="viewerTitle"></h3><div style="display:flex;gap:6px"><button id="viewerEditBtn" style="display:none" onclick="editFromViewer()">âœï¸ DÃ¼zenle</button><button onclick="closeViewer()">âœ• Kapat</button></div></div>
<div class="viewer-content" id="viewerContent"></div>
</div>
<div class="toast" id="toast"></div>

<!-- FIREBASE (Auth + Firestore only, no Storage) -->
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

<script>
// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  ğŸ”§ FIREBASE CONFIG â€” KENDÄ° BÄ°LGÄ°LERÄ°NÄ°ZLE     â•‘
// â•‘     DEÄÄ°ÅTÄ°RÄ°N                                  â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAiyBaOgWLFGb_f7CuQuTf5Rg_qMqjUKBs",
  authDomain: "halk-sag-icerik-kutuphanesi.firebaseapp.com",
  projectId: "halk-sag-icerik-kutuphanesi",
  storageBucket: "halk-sag-icerik-kutuphanesi.firebasestorage.app",
  messagingSenderId: "684370193198",
  appId: "1:684370193198:web:fdddd19975db52e6eda8bf",
  measurementId: "G-QFBSD0NQG0"
};

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  â˜ï¸ CLOUDINARY CONFIG â€” KENDÄ° BÄ°LGÄ°LERÄ°NÄ°ZLE   â•‘
// â•‘     DEÄÄ°ÅTÄ°RÄ°N                                  â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CLOUD_NAME = "dnz1jxdqm";       // Ã¶rn: "dxyz1234"
const UPLOAD_PRESET = "icerik_kutuphanesi"; // AdÄ±m 6'da oluÅŸturduÄŸunuz preset adÄ±

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const fsdb = firebase.firestore();

const TOPICS=[
{id:'ga',name:'GÃ¼venli Annelik',icon:'ğŸ¤°',color:'var(--ppk)'},
{id:'us',name:'Ãœreme SaÄŸlÄ±ÄŸÄ±',icon:'ğŸ’Š',color:'var(--pp)'},
{id:'cy',name:'CYBE / GYE',icon:'ğŸ§¬',color:'var(--pr)'},
{id:'yd',name:'YenidoÄŸan BakÄ±mÄ±',icon:'ğŸ‘¶',color:'var(--pb)'},
{id:'es',name:'Ergen SaÄŸlÄ±ÄŸÄ±',icon:'ğŸ§‘â€ğŸ¤â€ğŸ§‘',color:'var(--pg)'},
{id:'as',name:'AÅŸÄ±lar ve BaÄŸÄ±ÅŸÄ±klama',icon:'ğŸ’‰',color:'var(--py)'},
{id:'hs',name:'Halk SaÄŸlÄ±ÄŸÄ±',icon:'ğŸ¥',color:'var(--po)'},
{id:'vb',name:'Veri Bilimi',icon:'ğŸ“Š',color:'var(--pgr)'},
{id:'kr',name:'Kronik HastalÄ±klar',icon:'ğŸ«€',color:'#d4c9b8'},
{id:'ge',name:'Genel EÄŸitim',icon:'ğŸ“–',color:'#e0dcd8'}];
const TI={'Sesli Ã–zet':'ğŸ§','Video Ã–zet':'ğŸ¬','PDF Sunum':'ğŸ“„','Metin Ã–zeti':'ğŸ“'};

let items=[],currentFilter={type:'all'},currentTags=[],pendingFiles=[],currentUser=null,isAdmin=false,unsubItems=null,viewItemId=null;

// === CLOUDINARY UPLOAD ===
async function uploadToCloudinary(file, onProgress) {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('upload_preset', UPLOAD_PRESET);
  formData.append('resource_type', 'auto');

  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();
    xhr.open('POST', `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`);

    xhr.upload.onprogress = (e) => {
      if (e.lengthComputable && onProgress) {
        onProgress(e.loaded, e.total);
      }
    };

    xhr.onload = () => {
      if (xhr.status === 200) {
        const res = JSON.parse(xhr.responseText);
        resolve({
          name: file.name,
          type: file.type,
          size: file.size,
          url: res.secure_url,
          publicId: res.public_id,
          format: res.format
        });
      } else {
        reject(new Error('YÃ¼kleme hatasÄ±: ' + xhr.status));
      }
    };

    xhr.onerror = () => reject(new Error('AÄŸ hatasÄ±'));
    xhr.send(formData);
  });
}

// === AUTH ===
function signIn(){auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).catch(e=>toast('âŒ '+e.message));}
function signOut(){if(unsubItems)unsubItems();auth.signOut();}

auth.onAuthStateChanged(async u=>{
const ld=document.getElementById('loadingOverlay');
if(u){
  currentUser=u;
  console.log('UID:',u.uid,'â€” Bunu admins koleksiyonuna ekleyin');
  try{const d=await fsdb.collection('admins').doc(u.uid).get();isAdmin=d.exists&&d.data().role==='admin';}catch(e){isAdmin=false;}
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('appScreen').style.display='flex';
  document.getElementById('adminActions').style.display=isAdmin?'flex':'none';
  document.getElementById('userInfo').innerHTML=`<img src="${u.photoURL||''}" alt="" onerror="this.style.display='none'"><div><div class="name">${esc(u.displayName||u.email)}</div><div class="role">${isAdmin?'ğŸ‘‘ YÃ¶netici':'ğŸ‘¤ ZiyaretÃ§i'}</div></div>`;
  buildTopicSelect();setupFileDrop();setupTagInput();listenItems();ld.style.display='none';
}else{
  currentUser=null;isAdmin=false;items=[];
  document.getElementById('loginScreen').style.display='flex';
  document.getElementById('appScreen').style.display='none';ld.style.display='none';
}});

// === FIRESTORE REALTIME ===
function listenItems(){
if(unsubItems)unsubItems();
unsubItems=fsdb.collection('items').orderBy('createdAt','desc').onSnapshot(s=>{
  items=s.docs.map(d=>({id:d.id,...d.data()}));
  buildTopicNav();renderCards();
},e=>{console.error(e);toast('âŒ Veri yÃ¼kleme hatasÄ±');});
}

// === TOPICS ===
function buildTopicSelect(){
const s=document.getElementById('fTopic');s.innerHTML='<option value="">SeÃ§iniz...</option>';
TOPICS.forEach(t=>{const o=document.createElement('option');o.value=t.name;o.textContent=t.icon+' '+t.name;s.appendChild(o);});
}
function buildTopicNav(){
const n=document.getElementById('topicNav');n.innerHTML='';
TOPICS.forEach(t=>{const c=items.filter(i=>i.topic===t.name).length;if(!c)return;
const b=document.createElement('button');b.className='nav-btn';b.dataset.filter='topic:'+t.name;
b.innerHTML=`<span class="icon">${t.icon}</span>${t.name}<span class="badge">${c}</span>`;
b.onclick=()=>filterBy('topic',t.name);n.appendChild(b);});
}

// === FILTER ===
function filterBy(type,value){
currentFilter=type==='all'?{type:'all'}:{type,value};
document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
let s;if(type==='all')s='[data-filter="all"]';else if(type==='type')s=`[data-filter="type:${value}"]`;else s=`[data-filter="topic:${value}"]`;
const btn=document.querySelector(s);if(btn)btn.classList.add('active');renderCards();
if(window.innerWidth<=768)document.getElementById('sidebar').classList.remove('visible');
}
function getFiltered(){
let l=[...items];const q=document.getElementById('searchInput').value.toLowerCase().trim();
if(q)l=l.filter(i=>i.title.toLowerCase().includes(q)||(i.summary||'').toLowerCase().includes(q)||(i.tags||[]).some(t=>t.toLowerCase().includes(q))||(i.subtopic||'').toLowerCase().includes(q));
if(currentFilter.type==='type')l=l.filter(i=>i.contentType===currentFilter.value);
else if(currentFilter.type==='topic')l=l.filter(i=>i.topic===currentFilter.value);
return l;
}

// === RENDER ===
function renderCards(){
const area=document.getElementById('contentArea'),f=getFiltered();
document.getElementById('countAll').textContent=items.length;
const sr=document.getElementById('statsRow');
const c={'ğŸ§ Sesli':items.filter(i=>i.contentType==='Sesli Ã–zet').length,'ğŸ¬ Video':items.filter(i=>i.contentType==='Video Ã–zet').length,'ğŸ“„ PDF':items.filter(i=>i.contentType==='PDF Sunum').length,'ğŸ“ Metin':items.filter(i=>i.contentType==='Metin Ã–zeti').length};
sr.innerHTML=Object.entries(c).map(([k,v])=>`<div class="stat-card"><div class="num">${v}</div><div class="label">${k}</div></div>`).join('');
if(!f.length){area.innerHTML=`<div class="empty-state"><div class="icon">ğŸ“­</div><h3>HenÃ¼z iÃ§erik yok</h3><p>${isAdmin?'"Yeni Ä°Ã§erik" ile baÅŸlayÄ±n':'YÃ¶netici henÃ¼z iÃ§erik eklememiÅŸ'}</p></div>`;return;}
const g={};f.forEach(i=>{const k=i.topic||'DiÄŸer';if(!g[k])g[k]=[];g[k].push(i);});
let h='';for(const[topic,ti] of Object.entries(g)){
const t=TOPICS.find(x=>x.name===topic);
h+=`<div class="section-title">${t?t.icon:''} ${topic} (${ti.length})</div><div class="cards-grid">`;
ti.forEach(item=>{const tc=t?'t-'+t.id:'t-ge',icon=TI[item.contentType]||'ğŸ“',fc=(item.files||[]).length;
h+=`<div class="card" onclick="openItem('${item.id}')">
<div class="card-cover" style="background:${t?t.color:'#e8e2da'}"><span>${icon}</span><span class="type-badge">${item.contentType}</span>${fc?`<span class="file-count">ğŸ“ ${fc}</span>`:''}</div>
<div class="card-body"><h3>${esc(item.title)}</h3><div class="meta">${item.subtopic?esc(item.subtopic)+' Â· ':''}${item.instructor?esc(item.instructor):''}</div>
<div class="card-tags">${(item.tags||[]).slice(0,3).map(t=>`<span class="tag ${tc}">${esc(t)}</span>`).join('')}${(item.tags||[]).length>3?`<span class="tag" style="background:#eee">+${item.tags.length-3}</span>`:''}</div></div></div>`;});
h+='</div>';}
area.innerHTML=h;
}

// === ADD / EDIT ===
function openAddModal(editId){
if(!isAdmin)return;
document.getElementById('editId').value=editId||'';
document.getElementById('modalTitle').textContent=editId?'âœï¸ Ä°Ã§eriÄŸi DÃ¼zenle':'â• Yeni Ä°Ã§erik Ekle';
pendingFiles=[];
if(editId){
const item=items.find(i=>i.id===editId);if(!item)return;
document.getElementById('fTitle').value=item.title;
document.getElementById('fType').value=item.contentType;
document.getElementById('fTopic').value=item.topic;
document.getElementById('fSubtopic').value=item.subtopic||'';
document.getElementById('fInstructor').value=item.instructor||'';
document.getElementById('fSummary').value=item.summary||'';
currentTags=[...(item.tags||[])];renderTagsInput();
pendingFiles=(item.files||[]).map(ef=>({existing:ef}));renderPendingFiles();
}else{
['fTitle','fSubtopic','fInstructor','fSummary'].forEach(x=>document.getElementById(x).value='');
document.getElementById('fType').value='';document.getElementById('fTopic').value='';
currentTags=[];renderTagsInput();renderPendingFiles();
}
document.getElementById('addModal').classList.add('show');
}

async function saveItem(){
const title=document.getElementById('fTitle').value.trim(),type=document.getElementById('fType').value,topic=document.getElementById('fTopic').value;
if(!title||!type||!topic){toast('âš ï¸ Zorunlu alanlarÄ± doldurun');return;}
const btn=document.getElementById('saveBtn');btn.disabled=true;btn.innerHTML='<span class="spinner"></span> Kaydediliyor...';
const prog=document.getElementById('uploadProgress'),bar=document.getElementById('uploadBar');
try{
const editId=document.getElementById('editId').value;
const uploaded=[];
const newFiles=pendingFiles.filter(p=>!p.existing);
let totalSize=0,uploadedSize=0;
newFiles.forEach(p=>totalSize+=p.file.size);
if(totalSize>0){prog.style.display='block';bar.style.width='0%';}

for(const pf of pendingFiles){
  if(pf.existing){uploaded.push(pf.existing);continue;}
  const result = await uploadToCloudinary(pf.file, (loaded, total) => {
    const done = uploadedSize + loaded;
    bar.style.width = Math.round(done / totalSize * 100) + '%';
  });
  uploadedSize += pf.file.size;
  uploaded.push(result);
}

const data={title,contentType:type,topic,
subtopic:document.getElementById('fSubtopic').value.trim(),
instructor:document.getElementById('fInstructor').value.trim(),
tags:[...currentTags],summary:document.getElementById('fSummary').value.trim(),
files:uploaded,updatedAt:firebase.firestore.FieldValue.serverTimestamp(),updatedBy:currentUser.uid};
if(editId){await fsdb.collection('items').doc(editId).update(data);}
else{data.createdAt=firebase.firestore.FieldValue.serverTimestamp();data.createdBy=currentUser.uid;await fsdb.collection('items').add(data);}
pendingFiles=[];closeModal('addModal');toast(editId?'âœ… GÃ¼ncellendi':'âœ… Eklendi');
}catch(e){console.error(e);toast('âŒ '+e.message);}
finally{btn.disabled=false;btn.innerHTML='ğŸ’¾ Kaydet';prog.style.display='none';}
}

// === FILE MGMT ===
function setupFileDrop(){
const d=document.getElementById('fileDrop'),inp=document.getElementById('fileInput');
d.onclick=()=>inp.click();
d.ondragover=e=>{e.preventDefault();d.classList.add('dragover')};
d.ondragleave=()=>d.classList.remove('dragover');
d.ondrop=e=>{e.preventDefault();d.classList.remove('dragover');addFiles(e.dataTransfer.files)};
inp.onchange=()=>{addFiles(inp.files);inp.value='';};
}
function addFiles(fl){
for(const f of fl)pendingFiles.push({file:f});
renderPendingFiles();
if(fl.length&&!document.getElementById('fType').value){
const f=fl[0];
if(f.type.startsWith('audio'))document.getElementById('fType').value='Sesli Ã–zet';
else if(f.type.startsWith('video'))document.getElementById('fType').value='Video Ã–zet';
else if(f.type==='application/pdf')document.getElementById('fType').value='PDF Sunum';
}}
function renderPendingFiles(){
const c=document.getElementById('pendingFiles');
c.innerHTML=pendingFiles.map((pf,i)=>{
const name=pf.existing?pf.existing.name:pf.file.name,
size=((pf.existing?pf.existing.size:pf.file.size)/1024/1024).toFixed(1),
ic=pf.existing?'â˜ï¸':'ğŸ“';
return `<div class="file-item"><span>${ic}</span><span class="fname">${esc(name)}</span><span class="fsize">${size} MB</span><button class="fbtn del" onclick="removePF(${i})" title="KaldÄ±r">âœ•</button></div>`;
}).join('');
}
function removePF(i){
pendingFiles.splice(i,1);renderPendingFiles();
}

// === TAGS ===
function setupTagInput(){
const inp=document.getElementById('tagInput');
inp.onkeydown=e=>{
if(e.key==='Enter'&&inp.value.trim()){e.preventDefault();const v=inp.value.trim();if(!currentTags.includes(v)){currentTags.push(v);renderTagsInput();}inp.value='';}
if(e.key==='Backspace'&&!inp.value&&currentTags.length){currentTags.pop();renderTagsInput();}
};}
function renderTagsInput(){
const w=document.getElementById('tagWrap'),inp=document.getElementById('tagInput');
w.querySelectorAll('.tag').forEach(t=>t.remove());
currentTags.forEach((t,i)=>{const s=document.createElement('span');s.className='tag t-us';s.innerHTML=`${esc(t)} <button onclick="removeTag(${i})">&times;</button>`;w.insertBefore(s,inp);});
}
function removeTag(i){currentTags.splice(i,1);renderTagsInput();}

// === VIEWER ===
function openItem(id){
const item=items.find(i=>i.id===id);if(!item)return;
viewItemId=id;
const v=document.getElementById('viewer'),c=document.getElementById('viewerContent');
document.getElementById('viewerTitle').textContent=(TI[item.contentType]||'')+' '+item.title;
document.getElementById('viewerEditBtn').style.display=isAdmin?'inline-block':'none';
const files=item.files||[],t=TOPICS.find(x=>x.name===item.topic),tc=t?'t-'+t.id:'t-ge';
let fh='';
if(files.length){
fh='<div style="margin-top:18px"><h4 style="font-size:.84rem;margin-bottom:8px">ğŸ“ Ekli Dosyalar ('+files.length+')</h4>';
files.forEach(f=>{
const isP=f.type==='application/pdf'||(f.format&&f.format==='pdf'),
isA=f.type&&f.type.startsWith('audio'),
isV=f.type&&f.type.startsWith('video');
let preview='';
if(isP)preview=`<div style="text-align:center;padding:40px"><a href="${f.url}" target="_blank" style="display:inline-block;padding:16px 32px;background:linear-gradient(135deg,#b8a9c9,#e8c5d0);color:#fff;border-radius:12px;text-decoration:none;font-weight:600;font-size:1rem">ğŸ“„ PDF'yi GÃ¶rÃ¼ntÃ¼le</a></div>`;
else if(isA)preview=`<audio controls src="${f.url}" style="width:100%;margin-top:6px"></audio>`;
else if(isV)preview=`<video controls src="${f.url}" style="width:100%;max-height:380px;border-radius:8px;margin-top:6px"></video>`;
fh+=`<div style="margin-bottom:14px;padding:10px;background:var(--bg);border-radius:10px;border:1px solid var(--border)">
<div style="display:flex;align-items:center;gap:7px;font-size:.82rem">
<span>${isP?'ğŸ“„':isA?'ğŸ§':isV?'ğŸ¬':'ğŸ“'}</span>
<span style="flex:1;font-weight:500">${esc(f.name)}</span>
<span style="color:var(--muted);font-size:.72rem">${(f.size/1024/1024).toFixed(1)} MB</span>
<a href="${f.url}" target="_blank" class="btn btn-sm btn-secondary" style="text-decoration:none" onclick="event.stopPropagation()">â¬‡ï¸ Ä°ndir</a>
</div>${preview}</div>`;});
fh+='</div>';}

c.innerHTML=`<div class="text-view">
<h2 style="margin-bottom:6px">${esc(item.title)}</h2>
${item.subtopic?'<p style="color:var(--muted);margin-bottom:3px;font-size:.86rem">'+esc(item.subtopic)+'</p>':''}
${item.instructor?'<p style="color:var(--muted);margin-bottom:14px;font-size:.8rem">ğŸ‘¤ '+esc(item.instructor)+'</p>':''}
${item.summary?'<div style="white-space:pre-wrap;margin-bottom:6px">'+esc(item.summary)+'</div>':''}
${fh}
<div style="margin-top:14px;display:flex;gap:5px;flex-wrap:wrap">${(item.tags||[]).map(t=>`<span class="tag ${tc}">${esc(t)}</span>`).join('')}</div>
${isAdmin?`<div style="margin-top:18px;display:flex;gap:7px;border-top:1px solid var(--border);padding-top:14px">
<button class="btn btn-sm btn-secondary" onclick="editFromViewer()">âœï¸ DÃ¼zenle</button>
<button class="btn btn-sm btn-danger" onclick="deleteItem('${id}')">ğŸ—‘ï¸ Sil</button></div>`:''}
</div>`;
v.classList.add('show');
}
function editFromViewer(){closeViewer();openAddModal(viewItemId);}
function closeViewer(){document.getElementById('viewer').classList.remove('show');document.getElementById('viewerContent').innerHTML='';}

// === DELETE ===
async function deleteItem(id){
if(!confirm('Bu iÃ§eriÄŸi silmek istediÄŸinize emin misiniz?'))return;
try{
await fsdb.collection('items').doc(id).delete();
closeViewer();toast('ğŸ—‘ï¸ Silindi');
}catch(e){toast('âŒ '+e.message);}}

// === UTILS ===
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}
function closeModal(id){document.getElementById(id).classList.remove('show');}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('visible');}
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3000);}
document.addEventListener('keydown',e=>{if(e.key==='Escape'){closeViewer();closeModal('addModal');}});
</script>
</body>
</html>
